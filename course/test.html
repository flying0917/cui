<!DOCTYPE html>
<html>
<head>
	<title>test</title>
	<meta charset="utf-8">
	<meta name="viewport" content="initial-scale=1, maximum-scale=1">
	<style type="text/css">
		li
		{
			list-style: none;
		}
		div,body,html,ul,li
		{
			margin:0;
			padding:0;
		}
		body,html{
			width: 100%;
			height: 100%;

			overflow: hidden;
		}
		.test{
			height: 100%;
			overflow-x: hidden;
			overflow-y: auto;
		}
		#po
		{
			background-color:white;
		}
		/*加载插件*/
		.cui-loading-content
		{
			height:1rem;
			text-align: center;
			font-size:14px;
		}
		.cui-loading-content img
		{
			height:100%;
			margin-right:5px;
		}
		/*下拉刷新插件*/
		.cui-refresh-content
		{
			height:100%;
			width:100%;
			position:relative;
			background-color: #f9f9f9;
		}
		.cui-refresh-content .cui-refresh-header
		{
			position:absolute;
			width:100%;
			text-align: center;
		}
		.cui-refresh-header img
		{
			height:100%;
			vertical-align: middle;
			margin-right:5px;
		}
		.cui-refresh-wrap
		{
			min-height:100%;
		}

		/*轮播图*/
		.cui-swiper-content
		{
			width:100%;
			height:10rem;
			background-color:red;
			white-space: nowrap;
			position:relative;
		}
		.cui-swiper-content .cui-swiper-wrap
		{
			white-space: nowrap;
			margin-left:0;
			width:100%;
			font-size:0;
			-webkit-transition: margin-left .5s;
			-moz-transition: margin-left .5s;
			-ms-transition: margin-left .5s;
			-o-transition: margin-left .5s;
			transition: margin-left .5s;

		}
		.cui-swiper-content .cui-swiper-slide
		{
			width:100%;
			height:100%;
			display:inline-block;
			vertical-align: top;
			background-color:blue;
			text-align: center;
			line-height: 10rem;
			font-size:1rem;
		}
	</style>
</head>
<body>
<div class="test">

		<ul id="po">
			<li>
				<input type="button" value="test" onclick="test()">
			</li>
			<li>
				<div class="cui-swiper-content">
					<div class="cui-swiper-wrap" id="swiper-content">
						<div class="cui-swiper-slide">1</div>
						<div class="cui-swiper-slide">2</div>
						<div class="cui-swiper-slide">3</div>
						<div class="cui-swiper-slide">4</div>
					</div>
				</div>
			</li>
			<li>234</li>
			<li>234</li>
			<li>234</li>
			<li>234</li>
			<li>234</li>
			<li>234</li>
			<li>234</li>
			<li>234</li>
			<li>234</li>
			<li>234</li>
			<li>234</li>
			<li>234</li>
			<li>234</li>
			<li>234</li>
			<li>234</li>
			<li>234</li>
			<li>234</li>
			<li>234</li>
			<li>234</li>
			<li>234</li>
			<li>234</li>
			<li>234</li>
			<li>234</li>
			<li>234</li>
			<li>234</li>
			<li>234</li>
			<li>234</li>
			<li>234</li>
		</ul>
		<div class="cui-loading-content">

		</div>
</div>
</body>
<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
<script type="text/javascript">

	var now=0;
	function test()
	{
		var dom=document.getElementById("swiper-content");
		now+=360;
		dom.style.marginLeft="-"+now+"px";
	}
	//轮播图
	function cuiSwiper(param)
	{
	    this.domStr=param.doStr?param.doStr:".swiper-content";
	    this.init=function()
		{

		}
	}

	//下拉刷新插件  @todo 王榕 这个可能复杂点 搞了一天了 嘻嘻
	function cuiPullRefresh(param,fn)
	{
	    //是否开始
	    this.start=false;
	    //从手指触到屏幕时的Y坐标
	    this.startPageY=0;
        //从手指触到屏幕时的Y坐标
        this.startPageX=0;
	    //刷新头的高度
	    this.refreshHeaderHeight=50;
	    //容器里面的html字符串
	    this.contentHtml="";
	    //下拉的距离的触发点
	    this.triggerDistance=parseInt(param.triggerDistance)?parseInt(param.triggerDistance):200;
	    //是否在刷新
	    this.isRefreshing=false;
	    //下拉时
	    this.contentdownIcon=param.contentdownIcon?param.contentdownIcon:"http://static.oschina.net/uploads/img/201409/26074001_bzCh.gif";
	    this.contentdown=param.contentdown?param.contentdown:"下拉刷新";
	    //放开时
	    this.contentoverIcon=param.contentoverIcon?param.contentoverIcon:"http://static.oschina.net/uploads/img/201409/26074001_bzCh.gif";
        this.contentover=param.contentover?param.contentover:"松开刷新";
	    //刷新时
	    this.contentrefreshIcon=param.contentrefreshIcon?param.contentrefreshIcon:"http://static.oschina.net/uploads/img/201409/26074001_bzCh.gif";
        this.contentrefresh=param.contentrefresh?param.contentrefresh:"刷新中";
        //完成刷新时
        this.contentdoneIcon="http://static.oschina.net/uploads/img/201409/26074001_bzCh.gif";
        this.contentdone=param.contentdone?param.contentdone:"完成刷新";
	    //触发刷新时的回调
	    this.callback=(fn&&typeof fn==="function")?fn:(function(){});
	    if(!param.domStr)
		{
		    console.log("缺少容器选择字符串");
		    return false;
		}
		//获取容器
	    this.refresContentDom=param.domStr?document.querySelector(param.domStr):document.querySelector(".cui-refresh-content");
	    if(!this.refresContentDom)
		{
            console.log("缺少容器选择字符串");
            return false;
		}
	    //初始化
	    this.init=function()
		{
		    //渲染html
		    this.renderContent();
		    //绑定事件
		    this.bindEvent();
		};
	    //添加类的公用函数
	    this.addClass=function(dom,clsName)
		{
		    var nowClsName=dom.className;
		    if(nowClsName.indexOf(clsName)===-1)
			{
			    dom.className=nowClsName+" "+clsName;
			}
			return false;

		};
        //渲染html
	    this.renderContent=function()
		{
		    var temHtml="";
		    this.addClass(this.refresContentDom,"cui-refresh-content");
		    this.contentHtml=this.refresContentDom.innerHTML;
		    temHtml='<div class="cui-refresh-wrap" style="-webkit-transform: translateY(0px);\n' +
                '\t\t\t-moz-transform: translateY(0px);\n' +
                '\t\t\t-ms-transform: translateY(0px);\n' +
                '\t\t\t-o-transform: translateY(0px);\n' +
                '\t\t\ttransform: translateY(0px);">' +
                		'<div class="cui-refresh-header" style="line-height:'+this.refreshHeaderHeight+'px;height:'+this.refreshHeaderHeight+'px;top:-'+this.refreshHeaderHeight+'px">' +
							'<img src="'+this.contentdownIcon+'">'+
							'<span>'+this.contentdown+'</span>' +
						'</div>'
			            +this.contentHtml+
					'</div>';
            this.refresContentDom.innerHTML=temHtml;
            //要拖动的容器
            this.wrapContentDom=this.refresContentDom.children[0];
            //刷新的头
            this.headerContentDom=this.wrapContentDom.children[0];
            //刷新文本提示
            this.headerTextDom=this.headerContentDom.children[1];
            //刷新提示图标
            this.headerImgDom=this.headerContentDom.children[0];
		};
        //绑定事件
	    this.bindEvent=function()
		{
		    var that=this;
            that.wrapContentDom.addEventListener("touchstart",function(e)
			{
			    if(!that.isRefreshing&&that.refresContentDom.scrollTop===0)//当容器的滚动条滚动距离为0和不是在刷新状态时调用
				{
                    that.start=true;//开始
                    that.startPageY=e.changedTouches[0].pageY;//从手指触到屏幕时的Y坐标的赋值
                    that.startPageX=e.changedTouches[0].pageX;//从手指触到屏幕时的X坐标的赋值
				}
			});
            that.wrapContentDom.addEventListener("touchmove",function(e)
            {
                if(!that.isRefreshing&&that.refresContentDom.scrollTop===0)//当容器的滚动条滚动距离为0和不是在刷新状态时调用
				{
				    //手指滑动的Y长度
                    that.offsetTop=e.changedTouches[0].pageY-that.startPageY;
                    //手指滑动的X长度
                    that.offsetLeft=e.changedTouches[0].pageX-that.startPageX;

                    if(that.start&&that.offsetTop>0&&Math.abs(that.offsetTop/that.offsetLeft)>1.5)//下划角度超过45度时不干活
                    {
                        //下拉的动画
                        that.wrapContentDom.style.transform=that.wrapContentDom.style.webkitTransform="translateY("+that.offsetTop+"px)";
                        //是否大于下拉的距离的触发点
                        if(that.offsetTop>that.triggerDistance)
						{
                            that.headerTextDom.innerText=that.contentover;
                            that.headerImgDom.src=that.contentoverIcon;
						}
						else
						{
                            that.headerTextDom.innerText=that.contentdown;
                            that.headerImgDom.src=that.contentdownIcon;
						}
                    }
				}
            });
            that.wrapContentDom.addEventListener("touchend",function(e)
            {
                if(!that.isRefreshing&&that.start&&that.offsetTop>-that.refreshHeaderHeight)
				{
                    that.start=false;
                    that.wrapContentDom.style.transition=that.wrapContentDom.style.webkitTransition="all .5s";
                    //是否大于下拉的距离的触发点
                    if(that.offsetTop>that.triggerDistance)
                    {
                        //显示刷新中的动画
                        that.wrapContentDom.style.transform=that.wrapContentDom.style.webkitTransform="translateY("+that.refreshHeaderHeight+"px)";
                        setTimeout(function(){
                            that.wrapContentDom.style.transition=that.wrapContentDom.style.webkitTransition="";
                            //改变状态（正在刷新）
                            that.isRefreshing=true;
                            that.headerTextDom.innerText=that.contentrefresh;
                            that.headerImgDom.src=that.contentrefreshIcon;
                            //开始回调
							that.callback();
                        },500)

                    }
                    else
                    {
                        //还有到触发点，收起刷新动画
                        that.closeRefresh();
                    }
				}
            });
		};
		//收起刷新的动画
	    this.closeRefresh=function()
		{
            var that=this;
            //改变状态（不在刷新）
            that.isRefreshing=false;
            that.wrapContentDom.style.transition=that.wrapContentDom.style.webkitTransition="all .5s";
            that.wrapContentDom.style.transform=that.wrapContentDom.style.webkitTransform="translateY(0px)";
            setTimeout(function(){
                //清除动画
                that.wrapContentDom.style.transition=that.wrapContentDom.style.webkitTransition="";
            },500)
		};
		//完成刷新回调
	    this.refreshDone=function()
		{
		    var that=this;
            that.headerTextDom.innerText=that.contentdone;
            that.headerImgDom.src=that.contentdoneIcon;
            setTimeout(function(){
                that.closeRefresh();
			},500);
		};
	    this.init();
	}
	//下拉刷新用法
    var refresh=new cuiPullRefresh({domStr:".test"},function()
    {
        $("#po").html("");
        p=1;
        message(function()
		{
            refresh.refreshDone()
		})
    });
    Scroll(".test",message);
    //实例一个loading对象
    var load=new cuiLoading({domStr:".cui-loading-content"});
    var timeout="";
    var p=1;
    var length=20;

    function Scroll(dom,domFuc)
    {
        var callback=domFuc;
        $(dom).scroll(function(){
            var $that=$(this);
            if (timeout) {
                clearTimeout(timeout);
            }
            //节流
            timeout=setTimeout(function(){
                var scrollTop=$that.scrollTop();
                var scrollHeight=$that[0].scrollHeight;
                var windowHeight=$that.height();
                if(windowHeight+scrollTop>=scrollHeight)
                {
                    //回调
                    callback();
                }
            },100);

        });
    }
    function message(cb){
        var callback=cb&&(typeof cb==="function")?cb:function(){};
        //显示加载中
        load.showloading();
        var url="http://www.paishowtong.com/?r=item/housinginfo/SearchTwoHouse&page="+p+"&page_length="+length+"&sort_type=&sort_order="
        $.get(url,function(ret){
            var str="";
            if (ret.isSuccess) {

                if (ret.data.length) {
                    for(var i=0;i<ret.data.length;i++)
                    {
                        str+="<li>"+ret.data[i].desc+"</li>";
                    }

                    $("#po").append(str);
                    p++;
                    load.hideloading();
                }
                else if(ret.data.length===0&&p!==1)//判断是否还有内容
                {
                    //显示加载已经完成（没有内容了）
                    load.finishloading();
                }
                callback();
            }
        });
        // alert("已经到最底部了！");
    }

    /*加载插件*/
    function cuiLoading(param)
    {
        //获取加载图标的容器字符串
        this.domStr=param.domStr?param.domStr:"";
        if(this.domStr)
        {
            //获取加载图标的容器dom
            this.contentDom=this.domStr?document.querySelector(this.domStr):document.querySelector(".cui-loading-content");
            if(!this.contentDom)
			{
                console.log("没找到容器");
                return false;
			}

            this.type=param.type?param.type:"";
            //初始化
            this.init=function()
            {
                this.addClass(this.contentDom,".cui-loading-content");
                //往容器中添加img标签
                this.contentDom.innerHTML='<img src="https://file.digitaling.com/eImg/uimages/20150908/1441704518179024.gif"><span class="cui-loading-text">加载更多</span>'
                //获取容器中的文本提示标签
                this.textDom=document.querySelector(this.domStr+" .cui-loading-text");
            };
            //添加类的公用函数
            this.addClass=function(dom,clsName)
            {
                var nowClsName=dom.className;
                if(nowClsName.indexOf(clsName)===-1)
                {
                    dom.className=nowClsName+" "+clsName;
                }
                return false;

            };
            //显示加载中的插件
            this.showloading=function()
            {
                this.contentDom.style.display="block"
                this.textDom.innerText="加载中"
            }
            //隐藏加载中的插件
            this.hideloading=function()
            {
                this.contentDom.style.display="none"
            }
            //完成加载的提示
            this.finishloading=function()
            {
                this.textDom.innerText="没有内容了"
            }
            this.init();
        }
        else
        {
            console.log("缺少dom")
        }
    }
</script>
</html>